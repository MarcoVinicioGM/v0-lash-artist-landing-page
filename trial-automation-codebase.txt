# TRIAL REQUEST AUTOMATION CODEBASE
# Compiled for LLM Analysis - All relevant code for automating trial requests

## ============================================
## 1. API ROUTE - Form Submission Handler
## ============================================
# File: app/api/forms/submit/route.ts

import { NextRequest, NextResponse } from "next/server";
import { z } from "zod";

// Generic schema to accept any valid JSON object + timestamp
const dynamicFormSchema = z.object({
  type: z.string().optional(),
  submittedAt: z.string().optional(),
}).passthrough();

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const validationResult = dynamicFormSchema.safeParse(body);

    if (!validationResult.success) {
      return NextResponse.json(
        { error: "Invalid form data", details: validationResult.error },
        { status: 400 }
      );
    }

    // Secure server-side variable (ensure this is set in Vercel/env)
    const webhookUrl = process.env.FORM_WEBHOOK_URL; 

    if (!webhookUrl) {
      console.error("Missing FORM_WEBHOOK_URL");
      return NextResponse.json(
        { error: "Configuration error" },
        { status: 500 }
      );
    }

    const response = await fetch(webhookUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(validationResult.data),
    });

    if (!response.ok) {
      return NextResponse.json(
        { error: "Upstream webhook failed" },
        { status: 502 }
      );
    }

    return NextResponse.json(
      { success: true, message: "Form submitted successfully" },
      { status: 200 }
    );
  } catch (error) {
    console.error("Form submission error:", error);
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    );
  }
}

## ============================================
## 2. SCHEMAS - Form Validation Schemas
## ============================================
# File: lib/schemas.ts

import { z } from 'zod';

const contactFormSchema = z.object({
  name: z.string().min(2, 'Name must be at least 2 characters'),
  email: z.string().email('Please enter a valid email address'),
  phone: z.string().min(10, 'Please enter a valid phone number'),
});

export const educationInquirySchema = contactFormSchema.extend({
  instagram: z.string().min(1, 'Instagram or portfolio handle is required'),
  experience: z.enum([
    'Complete Beginner',
    'Self-Taught',
    'Licensed Esthetician/Cosmetologist',
    'Working Artist',
  ]),
  goal: z.enum([
    'Learn Basics',
    'Perfect my Skin Prep',
    'Business/Marketing',
    'Full Career Pivot',
  ]),
  modelAvailability: z.enum([
    'I can bring a model',
    'I need help finding a model',
  ]),
});

export const bridalFormSchema = contactFormSchema.extend({
  weddingDate: z.date({ required_error: 'Please select your wedding date' }),
  venueLocation: z.string().min(2, 'Please enter the venue location'),
  partySize: z.number().min(1, 'Party size must be at least 1'),
  details: z.string().optional(),
});

export const lessonFormSchema = contactFormSchema.extend({
  preferredDate: z.date({ required_error: 'Please select a preferred date' }),
  lessonType: z.string().min(1, 'Please select a lesson type'),
  skillLevel: z.string().min(1, 'Please select your skill level'),
  details: z.string().optional(),
});

export const contactFormSchemaSimple = contactFormSchema.extend({
  message: z.string().optional(),
});

export type ContactFormData = z.infer<typeof contactFormSchema>;
export type EducationInquiryData = z.infer<typeof educationInquirySchema>;
export type BridalFormData = z.infer<typeof bridalFormSchema>;
export type LessonFormData = z.infer<typeof lessonFormSchema>;
export type ContactFormSimpleData = z.infer<typeof contactFormSchemaSimple>;

## ============================================
## 3. CONSTANTS - Booking Links and Configuration
## ============================================
# File: lib/constants.ts

export const SOCIAL_LINKS = {
  instagram: "https://www.instagram.com/makeupbyannagarcia/?hl=en",
  tiktok: "https://www.tiktok.com/@anna6arcia?lang=en",
  facebook: "https://www.facebook.com/makeupbyannagarcia/",
  email: "hello@amorglambeauty.com",
};

export const CONTACT_LINKS = {
  email: `mailto:${SOCIAL_LINKS.email}`,
};

export const SQUARE_CONFIG = {
  siteId: "qfxgtk2tjw6cdx",
  locationId: "1KGG5A28052PD",
  baseUrl: "https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD/services",
  websiteUrl: "https://www.makeupbyannagarcia.com",
};

export const SQUARE_SERVICES = {
  glam: "3S4Z5ABQFLR3BH5NWRFBSBET",
  microblading: "KPUQEF4UNIOFG53NM5WWHX4N",
  browShaping: "UDFC5XY53T34QRTXTURYO5DB",
  browStain: "7TBJAXO7RHYYPEX4Q6QSERRT",
  browLaminationAndShaping: "3MCEC46SFWUWOKEUUZPKYQ2J",
  browBundle: "AX6HUA2WQVNGK3NEFAL2TPPT",
  houseCall: "SBGABWWO4OVYOD7NLFPKL27C",
  bridalParty: "WITZHMIKG74YCA5QCJPPTEIO",
};

export const BOOKING_LINKS = {
  general: `${SQUARE_CONFIG.websiteUrl}`,
  glam: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=3S4Z5ABQFLR3BH5NWRFBSBET`,
  softGlam: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=3S4Z5ABQFLR3BH5NWRFBSBET`,
  fullGlam: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=3S4Z5ABQFLR3BH5NWRFBSBET`,
  bridal: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=WITZHMIKG74YCA5QCJPPTEIO`,
  microblading: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=KPUQEF4UNIOFG53NM5WWHX4N`,
  browLaminationBundle: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=AX6HUA2WQVNGK3NEFAL2TPPT`,
  houseCall: `https://book.squareup.com/appointments/qfxgtk2tjw6cdx/location/1KGG5A28052PD?buttonTextColor=000000&color=ffb2f0&locale=en&referrer=so&service_id=SBGABWWO4OVYOD7NLFPKL27C`,
};

export const SQUARESPACE_PRODUCT_URL = "https://www.makeupbyannagarcia.com";

## ============================================
## 4. EDUCATION APPLICATION MODAL - Lesson Inquiry Form
## ============================================
# File: components/education-application-modal.tsx (Lines 59-84 - Submit Logic)

  const onSubmit = async (data: EducationInquiryData) => {
    try {
      const payload = {
        ...data,
        type: "education_inquiry",
        submittedAt: new Date().toISOString(),
      };

      const response = await fetch("/api/forms/submit", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!response.ok) throw new Error("Submission failed");

      setIsSubmitted(true);
      setTimeout(() => {
        onOpenChange(false);
        setIsSubmitted(false);
        reset();
      }, 2500);
    } catch (error) {
      console.error("Submission error:", error);
    }
  };

## ============================================
## 5. LESSON INQUIRY FORM - Education Page
## ============================================
# File: app/education/page.tsx (Lines 137-155 - Submit Logic)

  const onSubmit = (data: LessonFormData) => {
    const webhookPayload = {
      ...data,
      preferredDate: data.preferredDate.toISOString(),
      submittedAt: new Date().toISOString(),
    };

    console.log(
      "Lesson Inquiry Request:",
      JSON.stringify(webhookPayload, null, 2),
    );

    setIsSubmitted(true);
    setTimeout(() => {
      onOpenChange(false);
      setIsSubmitted(false);
      reset();
    }, 2500);
  };

## ============================================
## 6. BRIDAL INQUIRY FORM - Bridal Page
## ============================================
# File: app/bridal/page.tsx (Lines 195-199 - Submit Logic)

  const onSubmit = async (data: BridalFormData) => {
    await new Promise((resolve) => setTimeout(resolve, 1500));
    console.log("Bridal Lead:", data);
    onSuccess();
  };

## ============================================
## 7. BRIDAL TRIAL BOOKING BUTTON - Bridal Page
## ============================================
# File: app/bridal/page.tsx (Lines 386-399 - Trial Booking Button)

              <Button
                asChild
                variant="outline"
                size="lg"
                className="h-14 px-8 rounded-none border-white text-white hover:bg-white hover:text-black bg-transparent"
              >
                <a
                  href={BOOKING_LINKS.bridal}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Book Trial Run
                </a>
              </Button>

## ============================================
## 8. BRIDAL PACKAGES - Including Trial Package
## ============================================
# File: app/bridal/page.tsx (Lines 83-95 - Trial Package Definition)

  {
    id: "trial",
    title: "The Preview (Trial)",
    price: "$200",
    description:
      "A 2-hour collaborative session at our studio to design your perfect look before the big day.",
    features: [
      "2-Hour Consultation & Application",
      "Multiple Lip/Eye Options",
      "Face Chart & Product Breakdown",
      "Skin Prep Routine Recommendations",
      "Photos & Lighting Test",
    ],
  },

## ============================================
## 9. CONTACT FORM - General Inquiry
## ============================================
# File: components/contact-section.tsx (Lines 24-30 - Submit Handler)

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitted(true);
    setTimeout(() => {
      setIsSubmitted(false);
    }, 3000);
  };

## ============================================
## 10. PACKAGE.JSON - Dependencies
## ============================================
# File: package.json (Key Dependencies)

  "dependencies": {
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-dialog": "^1.1.5",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "framer-motion": "^12.26.2",
    "next": "^16.0.10",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.60.0",
    "zod": "^3.25.76",
  },

## ============================================
## ANALYSIS SUMMARY
## ============================================

CURRENT TRIAL REQUEST SYSTEM:
1. Bridal Trials - Direct link to Square (no automation)
   - Button at /bridal: "Book Trial Run" → BOOKING_LINKS.bridal (Square)
   - No form submission, just external redirect

2. Lesson Trials - Form submission to /api/forms/submit
   - EducationApplicationModal: Submits with type="education_inquiry"
   - LessonInquiryDialog: Only logs to console (NOT submitting to API)

3. Bridal Inquiries - Form submission (mock only)
   - BridalInquiryForm: console.log only, no API submission

4. General Contact - Form submission (mock only)
   - ContactSection: No submission, just timeout

ISSUES IDENTIFIED:
1. Lesson inquiry form doesn't submit to API (console.log only)
2. Bridal inquiry form doesn't submit to API (mock only)
3. Contact form doesn't submit to API (no submission logic)
4. Bridal trial is external link to Square (no data capture)
5. No centralized automated workflow
6. Different submission patterns across forms

AUTOMATION OPTIONS:

OPTION 1: Webhook Integration (Fastest Implementation)
- Fix all forms to submit to /api/forms/submit
- Connect FORM_WEBHOOK_URL to n8n/Zapier
- Automate: email notifications, CRM updates, calendar invites

OPTION 2: Square API Integration
- Integrate Square API directly
- Create custom booking flow with trial-specific logic
- Sync with existing Square services

OPTION 3: Database + Custom Backend
- Build Postgres/SQLite database
- Create admin dashboard for trial management
- Implement automated email sequences

RECOMMENDED APPROACH:
1. Fix form submissions to use /api/forms/submit
2. Set up n8n workflow at FORM_WEBHOOK_URL
3. Automate: email alerts → CRM entry → calendar sync
4. Gradually migrate to Square API for direct booking management

